# Emuera macOS 运行说明

## 📋 目录结构

```
emuera-mac/
├── Emuera/                          # 主项目目录
│   ├── Sources/
│   │   ├── EmueraCore/             # 核心引擎 (所有功能都在这里)
│   │   │   ├── Parser/             # 解析器系统
│   │   │   ├── Executor/           # 执行器系统
│   │   │   ├── Services/           # 服务系统 (文件I/O等)
│   │   │   └── UI/                 # UI系统
│   │   ├── EmueraApp/              # 命令行应用
│   │   └── EmueraGUI/              # GUI应用
│   └── Package.swift
├── README.md                        # 项目说明
├── STATUS.md                        # 状态看板
└── 运行说明.md                      # 本文件
```

## 🚀 快速开始

### 1. 环境要求

- **macOS 13.0+** (Ventura)
- **Xcode 14+** 或 **Swift 5.9+**
- **命令行工具** (Command Line Tools)

### 2. 编译项目

```bash
cd /Users/ss/Documents/Project/iOS/emuera-mac/Emuera

# 编译所有目标
swift build

# 或者编译特定目标
swift build --product emuera          # 命令行版本
swift build --product EmueraGUI       # GUI版本
```

## 🎮 运行方式

### 方式一：命令行控制台 (推荐测试)

```bash
# 进入项目目录
cd /Users/ss/Documents/Project/iOS/emuera-mac/Emuera

# 运行交互式控制台
swift run emuera

# 或者直接运行编译后的二进制
swift run emuera
```

**交互式控制台支持的命令**:
```
emuera> help          # 显示帮助
emuera> test          # 运行基础测试脚本
emuera> exprtest      # 表达式解析器测试
emuera> scripttest    # 语法解析器测试
emuera> processtest   # Process系统测试
emuera> integrationtest  # 完整集成测试
emuera> demo          # 运行演示脚本
emuera> exit          # 退出
```

### 方式二：运行测试脚本

```bash
# 运行基础测试
swift run emuera test

# 运行完整集成测试
swift run emuera integrationtest

# 运行Process+UI测试
swift run emuera uitest
```

### 方式三：GUI应用 (macOS)

```bash
# 编译GUI应用
swift build --product EmueraGUI

# 运行GUI应用
swift run EmueraGUI
```

**GUI功能**:
- ✅ 主窗口和工具栏
- ✅ 控制台显示区域
- ✅ 文件选择和运行
- ✅ 调试面板
- ✅ 偏好设置

## 📁 游戏文件位置

### 默认文件夹结构

Emuera macOS会自动创建以下文件夹用于存储游戏文件：

```
~/Library/Application Support/Emuera/
├── Examples/              # 示例脚本目录
├── Games/                 # 游戏文件目录
├── Saves/                 # 存档目录
└── Config/                # 配置文件
```

### 如何放置游戏文件

#### 方法1：使用GUI应用打开

1. 启动EmueraGUI
2. 点击工具栏的"打开文件"按钮 (文件夹图标)
3. 选择你的 `.erb` 脚本文件
4. 点击"运行"按钮 (绿色播放图标)

#### 方法2：使用命令行运行文件

```bash
# 直接运行脚本文件
swift run emuera run /path/to/your/script.erb

# 或者在交互模式中使用run命令
swift run emuera
emuera> run /path/to/your/script.erb
```

#### 方法3：创建示例目录

```bash
# 创建示例目录
mkdir -p ~/Library/Application\ Support/Emuera/Examples

# 复制你的ERB文件到该目录
cp /path/to/your/game/*.erb ~/Library/Application\ Support/Emuera/Examples/

# 然后在GUI中点击"打开示例"按钮
```

## 📝 支持的脚本语法

### 基础命令

```erb
PRINT Hello World!     # 输出文本（不换行）
PRINTL Hello World!    # 输出文本并换行
WAIT                   # 等待用户输入
QUIT                   # 退出程序
```

### 变量操作

```erb
A = 100                # 赋值
B = A + 50             # 表达式计算
PRINT A                # 输出变量值
PRINT A的值是          # 输出中文
PRINT A
PRINTL
```

### 条件语句

```erb
IF A > 5
  PRINTL A大于5
ELSE
  PRINTL A小于等于5
ENDIF
```

### 循环

```erb
# WHILE循环
COUNT = 0
WHILE COUNT < 3
  PRINT COUNT
  COUNT = COUNT + 1
ENDWHILE

# FOR循环
FOR I, 1, 5
  PRINT I
ENDFOR
```

### 函数调用

```erb
CALL MYFUNC
PRINT A

@MYFUNC
  A = 150
  RETURN
```

### GOTO跳转

```erb
A = 10
GOTO SKIP
A = 20
SKIP:
PRINT A  # 输出: 10
```

### SELECTCASE

```erb
A = 2
SELECTCASE A
  CASE 1
    PRINTL 一
  CASE 2
    PRINTL 二
  CASE 3
    PRINTL 三
  CASEELSE
    PRINTL 其他
ENDSELECT
```

## 🧪 测试你的脚本

### 1. 创建测试脚本

创建一个文件 `test.erb`:

```erb
PRINTL === Emuera macOS 测试 ===
PRINTL

A = 100
B = 200
C = A + B

PRINT A =
PRINT A
PRINTL

PRINT B =
PRINT B
PRINTL

PRINT A + B =
PRINT C
PRINTL

IF C > 250
  PRINTL C大于250
ELSE
  PRINTL C小于等于250
ENDIF

PRINTL
PRINTL === 测试完成 ===
QUIT
```

### 2. 运行测试

**命令行方式**:
```bash
swift run emuera run /path/to/test.erb
```

**交互方式**:
```bash
swift run emuera
emuera> run /path/to/test.erb
```

**GUI方式**:
1. 启动 `swift run EmueraGUI`
2. 点击"打开文件"按钮
3. 选择 `test.erb`
4. 点击"运行"按钮

## 🔧 常见问题

### Q: 编译失败？

**A**: 确保Swift版本 >= 5.9
```bash
swift --version
```

### Q: 找不到EmueraGUI？

**A**: 需要先编译
```bash
swift build --product EmueraGUI
```

### Q: 脚本运行出错？

**A**: 检查脚本语法，当前支持:
- ✅ PRINT/PRINTL
- ✅ IF/ELSE/ENDIF
- ✅ WHILE/ENDWHILE
- ✅ FOR/ENDFOR
- ✅ CALL/RETURN
- ✅ GOTO/标签
- ✅ SELECTCASE/CASE/ENDSELECT
- ✅ 变量赋值和表达式

### Q: 如何查看调试信息？

**A**: 在GUI中点击"调试"按钮 (虫子图标)，或在命令行中查看详细输出。

## 📊 当前功能状态

| 功能 | 状态 | 说明 |
|------|------|------|
| 命令行运行 | ✅ 完成 | 交互式控制台 |
| GUI运行 | ✅ 完成 | SwiftUI界面 |
| 脚本解析 | ✅ 完成 | 支持中文和Unicode |
| 变量系统 | ✅ 完成 | 持久化变量 |
| 流程控制 | ✅ 完成 | IF/WHILE/FOR等 |
| 函数调用 | ✅ 完成 | CALL/RETURN |
| GOTO跳转 | ✅ 完成 | 标签跳转 |
| 文件I/O | ✅ 完成 | 读写文件 |
| CSV解析 | ✅ 完成 | 数据加载 |
| ERH头文件 | ✅ 完成 | #FUNCTION/#DIM |

## 🎯 下一步操作

1. **运行集成测试**验证一切正常:
   ```bash
   swift run emuera integrationtest
   ```

2. **尝试简单脚本**:
   ```bash
   swift run emuera demo
   ```

3. **创建你自己的脚本**并测试

4. **启动GUI应用**体验完整功能:
   ```bash
   swift run EmueraGUI
   ```

## 📞 获取帮助

- 查看 `README.md` 了解项目详情
- 查看 `STATUS.md` 了解当前进度
- 运行 `help` 命令查看可用命令
- 检查控制台输出的错误信息

---

**祝你使用愉快！** 🚀

*最后更新: 2025-12-20*
