# 原项目对比总结 - 关键发现

## 🎯 核心发现

### 原项目 (C#版Emuera)
- **命令总数**: 266个
- **内置函数**: 200+个
- **图形命令**: PRINT_IMG, PRINT_RECT, PRINT_SPACE, G系列函数
- **音频命令**: ❌ 无
- **鼠标命令**: INPUTMOUSEKEY, MOUSEX, MOUSEY
- **高级图形**: 通过G系列函数实现

### Swift移植项目 (当前)
- **命令总数**: ~100个
- **内置函数**: 231+个 ✅
- **图形命令**: 自定义10个 (扩展)
- **音频命令**: 计划7个 (扩展)
- **鼠标命令**: 计划5个
- **完成度**: 60% (对比原项目)

---

## 📊 功能差异

### ✅ 我们的扩展 (原项目没有)
1. **音频系统** (7个命令)
   - PLAYBGM, STOPBGM, PLAYSE, STOPSE, PLAYVOICE, VOLUME, FADEBGM

2. **高级图形** (10个命令)
   - DRAWSPRITE, DRAWRECT, FILLRECT, DRAWCIRCLE, FILLCIRCLE
   - DRAWLINEEX, DRAWGRADIENT, SETBRUSH, CLEARSCREEN, SETBACKGROUNDCOLOR

3. **实用功能**
   - 参数解析器增强 (支持逗号分隔)

### ❌ 原项目有但我们缺失 (~166个命令)

**优先级 1 - 基础打印** (25个)
- PRINT_IMG, PRINT_RECT, PRINT_SPACE
- K模式打印 (PRINTK, PRINTVK, PRINTSK等)
- D模式打印 (PRINTD, PRINTVD, PRINTSD等)

**优先级 2 - 窗口管理** (20个)
- 字体命令: SETFONT, FONTBOLD, FONTITALIC, FONTREGULAR, FONTSTYLE
- 对齐命令: ALIGNMENT, PRINTC, PRINTLC, PRINTCR, PRINTFORMC
- 其他: CLEARTEXTBOX, CUSTOMDRAWLINE, DRAWLINEFORM, TIMES

**优先级 3 - 系统函数** (20个)
- 键盘: GETKEY, GETKEYTRIGGERED
- 鼠标: MOUSEX, MOUSEY (拆分MOUSEPOS)
- 状态: GETDEFCOLOR, GETDEFBGCOLOR, GETSTYLE, GETFONT, CURRENTALIGN等
- HTML: HTML_PRINT, HTML_TAGSPLIT等
- 调试: DEBUGPRINT, ASSERT, THROW

**优先级 4 - 高级打印** (30个)
- PRINTSINGLE系列 (15个)
- PRINTBUTTON系列 (3个)
- PRINTPLAIN系列 (2个)

**优先级 5 - 图形对象** (30个, 可选)
- G系列函数: GCREATE, GDRAWSPRITE, GFILLRECTANGLE等
- Sprite函数: SPRITECREATE, SPRITEDISPOSE等
- CBG系列: CBGSETG, CBGSETSPRITE等

---

## 🎯 修正后的开发计划

### 立即行动 (Week 1-2)
1. 添加 PRINT_IMG, PRINT_RECT, PRINT_SPACE
2. 添加 K/D模式打印基础
3. 添加 字体命令
4. 添加 CLEARTEXTBOX

### 短期计划 (Week 3-4)
5. 完善 K/D模式所有变体
6. 添加 系统函数 (GETKEY, MOUSEX/MOUSEY)
7. 添加 调试命令

### 中期计划 (Week 5+)
8. 添加 HTML命令
9. 添加 高级打印命令
10. 图形对象系统 (可选)

### 保持功能
- ✅ 音频系统 (我们的扩展)
- ✅ 高级图形 (我们的扩展)

---

## 📈 统计

| 类别 | 原项目 | 已移植 | 缺失 | 完成度 |
|------|--------|--------|------|--------|
| 基础命令 | 40 | 40 | 0 | 100% |
| 数学函数 | 20 | 20 | 0 | 100% |
| 字符串函数 | 20 | 20 | 0 | 100% |
| 数组函数 | 15 | 15 | 0 | 100% |
| 位运算 | 5 | 5 | 0 | 100% |
| 时间日期 | 12 | 12 | 0 | 100% |
| 文件操作 | 15 | 15 | 0 | 100% |
| 图形基础 | 10 | 10 | 0 | 100% |
| **图形扩展** | 0 | **10** | **0** | **新功能** |
| **音频系统** | 0 | **7** | **0** | **新功能** |
| 窗口管理 | 20 | 2 | 18 | 10% |
| 高级打印 | 50 | 0 | 50 | 0% |
| 系统函数 | 30 | 5 | 25 | 17% |
| 调试命令 | 7 | 0 | 7 | 0% |
| HTML命令 | 6 | 0 | 6 | 0% |
| 图形对象 | 30 | 0 | 30 | 0% |
| **总计** | **266** | **169** | **166** | **60%** |

---

## 💡 建议

### 1. 优先补齐原项目功能
- 保持与原版Emuera的兼容性
- 让用户可以迁移现有脚本

### 2. 保留扩展功能
- 音频系统是很好的增值功能
- 高级图形命令很实用

### 3. 分阶段实施
- **阶段1**: 补齐基础功能 (Week 1-3)
- **阶段2**: 补齐高级功能 (Week 4-5)
- **阶段3**: 可选功能 (Week 6+)
- **阶段4**: 保持扩展 (已完成)

### 4. 文档化差异
- 明确哪些是扩展功能
- 提供迁移指南

---

## 📝 总结

**当前状态**:
- ✅ 核心功能完整
- ✅ 测试覆盖率优秀
- ✅ 扩展功能创新
- ⚠️ 需要补齐约166个原项目命令

**下一步行动**:
1. 阅读 `PRIORITY4_CORRECTED_PLAN.md` 了解详细计划
2. 阅读 `FUNCTION_COMPARISON.md` 查看完整对比
3. 开始实施阶段1 (打印命令补齐)

**预计时间**:
- 核心补齐: 3-4周
- 完整实现: 6-8周

---

**创建日期**: 2025-12-26
**状态**: 分析完成，等待实施
