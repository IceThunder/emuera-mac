# 剩余命令执行逻辑实现计划 - Week 1

**制定日期**: 2025-12-26
**当前状态**: 解析器限制已修复 ✅
**目标**: 完成P0和P1优先级命令 (约19个)

---

## 📊 命令分布分析

### 剩余命令统计
- **总剩余**: 约19个命令需要在visitCommandStatement中添加case
- **已实现**: 220个命令在switch中 + 59个独立visit方法 = 279个
- **总计**: 298个命令定义

### 优先级分类

#### P0 - 核心流程控制 (5个) ⭐⭐⭐⭐⭐
| 命令 | 说明 | 难度 | 预计时间 |
|------|------|------|----------|
| IF | 条件分支开始 | 中 | 30分钟 |
| ELSE | 否则分支 | 简单 | 15分钟 |
| ELSEIF | 否则如果 | 简单 | 15分钟 |
| ENDIF | 条件分支结束 | 简单 | 15分钟 |
| SIF | 单行条件输出 | 简单 | 20分钟 |

**小计**: 5个命令，预计1-2小时

---

#### P1 - 基础输入输出 (14个) ⭐⭐⭐⭐
| 命令 | 说明 | 难度 | 预计时间 |
|------|------|------|----------|
| WAIT | 等待任意键 | 简单 | 10分钟 |
| WAITANYKEY | 等待任意键 | 简单 | 10分钟 |
| TINPUT | 带超时输入 | 中 | 25分钟 |
| TINPUTS | 带超时字符串输入 | 中 | 25分钟 |
| TONEINPUT | 单字符带超时输入 | 中 | 25分钟 |
| TONEINPUTS | 单字符带超时输入 | 中 | 25分钟 |
| PRINTV | 变量输出 | 简单 | 15分钟 |
| PRINTVL | 变量输出换行 | 简单 | 10分钟 |
| PRINTVW | 变量输出等待 | 简单 | 10分钟 |
| PRINTS | 字符串输出 | 简单 | 15分钟 |
| PRINTSL | 字符串输出换行 | 简单 | 10分钟 |
| PRINTSW | 字符串输出等待 | 简单 | 10分钟 |
| PRINTFORMS | 格式化字符串输出 | 中 | 20分钟 |
| PRINTFORMSL | 格式化字符串输出换行 | 简单 | 15分钟 |

**小计**: 14个命令，预计2.5-3小时

---

#### P2 - 数据操作 (8个) ⭐⭐⭐
| 命令 | 说明 | 难度 | 预计时间 |
|------|------|------|----------|
| SET | 变量赋值 | 中 | 25分钟 |
| VARSET | 数组初始化 | 中 | 30分钟 |
| VARSIZE | 数组大小 | 简单 | 15分钟 |
| SWAP | 变量交换 | 简单 | 15分钟 |
| REF | 引用赋值 | 中 | 25分钟 |
| REFBYNAME | 按名引用 | 中 | 30分钟 |
| STRLEN | 字符串长度 | 简单 | 15分钟 |
| SPLIT | 字符串分割 | 中 | 30分钟 |

**小计**: 8个命令，预计2.5-3小时

---

#### P3 - 角色管理 (6个) ⭐⭐⭐
| 命令 | 说明 | 难度 | 预计时间 |
|------|------|------|----------|
| SAVECHARA | 保存角色 | 中 | 30分钟 |
| LOADCHARA | 加载角色 | 中 | 30分钟 |
| SAVEGAME | 保存游戏 | 中 | 30分钟 |
| LOADGAME | 加载游戏 | 中 | 30分钟 |
| CHARACOUNT | 角色数量 | 简单 | 15分钟 |
| CHARAEXISTS | 角色是否存在 | 简单 | 15分钟 |

**小计**: 6个命令，预计2.5-3小时

---

## 📅 每日实施计划

### Day 1 (12月27日) - 核心流程控制
**目标**: 完成P0类5个命令
- 上午: IF/ELSE/ELSEIF/ENDIF (1.5小时)
- 下午: SIF + 测试验证 (1小时)
- 晚上: 提交代码 + 文档更新 (30分钟)

**预期成果**: 流程控制基础完成

---

### Day 2 (12月28日) - 输入命令
**目标**: 完成P1类前7个命令
- 上午: WAIT/WAITANYKEY + TINPUT系列 (2小时)
- 下午: 测试验证 (1小时)
- 晚上: 提交代码 (30分钟)

**预期成果**: 用户输入交互完成

---

### Day 3 (12月29日) - 输出命令
**目标**: 完成P1类后7个命令
- 上午: PRINTV/PRINTVL/PRINTVW + PRINTS系列 (1.5小时)
- 下午: PRINTFORMS系列 + 测试 (1小时)
- 晚上: 提交代码 (30分钟)

**预期成果**: 变量/字符串输出完成

---

### Day 4 (12月30日) - 数据操作基础
**目标**: 完成P2类前4个命令
- 上午: SET + VARSET (1.5小时)
- 下午: VARSIZE + SWAP + 测试 (1小时)
- 晚上: 提交代码 (30分钟)

**预期成果**: 基础数据操作完成

---

### Day 5 (12月31日) - 数据操作高级
**目标**: 完成P2类后4个命令
- 上午: REF + REFBYNAME (1.5小时)
- 下午: STRLEN + SPLIT + 测试 (1.5小时)
- 晚上: 提交代码 (30分钟)

**预期成果**: 高级数据操作完成

---

### Day 6 (1月1日) - 角色管理基础
**目标**: 完成P3类前3个命令
- 上午: SAVECHARA + LOADCHARA (1.5小时)
- 下午: CHARACOUNT + CHARAEXISTS + 测试 (1小时)
- 晚上: 提交代码 (30分钟)

**预期成果**: 角色管理基础完成

---

### Day 7 (1月2日) - 角色管理高级 + 整合
**目标**: 完成P3类后3个命令 + 整体测试
- 上午: SAVEGAME + LOADGAME (1.5小时)
- 下午: 完整测试验证 (1.5小时)
- 晚上: 提交代码 + 更新文档 (1小时)

**预期成果**: Week 1全部完成

---

## 🎯 Week 1 预期成果

### 代码层面
- ✅ 新增19个命令的execute方法
- ✅ 更新StatementExecutor.swift
- ✅ 通过所有新测试

### 文档层面
- ✅ 更新CURRENT_STATUS.md
- ✅ 更新README.md
- ✅ 添加Week 1完成报告

### 进度层面
- **命令完成度**: 200/298 → 219/298 (73.5%)
- **测试通过率**: 保持97%+
- **时间投入**: 7天 × 3-4小时 = 21-28小时

---

## 🔧 实现策略

### 1. 模式参考
每个命令实现参考以下模式：
```swift
case .COMMAND_NAME:
    // 1. 解析参数
    // 2. 执行逻辑
    // 3. 返回结果
    return { context in
        // 执行代码
    }
```

### 2. 测试驱动
每个命令完成后立即测试：
```swift
// 在CommandVerification.swift中添加测试
testCommand("COMMAND arg1, arg2", expected: "result")
```

### 3. 批量提交
每天结束时提交：
- 当天实现的命令
- 对应的测试用例
- 文档更新

---

## 📋 检查清单

### 每日工作流程
- [ ] 选择3-5个相关命令
- [ ] 实现execute方法
- [ ] 编写测试用例
- [ ] 运行验证
- [ ] 更新文档
- [ ] 提交代码

### 质量要求
- [ ] 代码符合KISS原则
- [ ] 测试覆盖正常和异常情况
- [ ] 文档清晰说明
- [ ] 无编译错误
- [ ] 测试通过率>97%

---

## 🚀 开始行动

**今天是Day 1**: 开始实现P0核心流程控制

**任务列表**:
1. ✅ IF语句实现
2. ✅ ELSE语句实现
3. ✅ ELSEIF语句实现
4. ✅ ENDIF语句实现
5. ✅ SIF语句实现

**预计完成时间**: 2025-12-27 晚上

---

**备注**:
- 这个计划基于分析结果，实际执行时可能需要调整
- 每天完成后会更新实际进度
- 如果遇到复杂问题，会适当延长某些任务时间
- 保持与C# Emuera的行为一致性是首要目标
